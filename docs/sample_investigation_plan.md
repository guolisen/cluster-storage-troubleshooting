# Sample Investigation Plan Output

This document demonstrates the Investigation Plan format generated by the Plan Phase for a hypothetical Kubernetes volume I/O error scenario.

## Scenario
- **Target Pod**: `nginx-deployment-abc123` in namespace `production`
- **Volume Path**: `/var/www/html`
- **Issue**: Volume I/O errors causing pod crashes

## Knowledge Graph Context
- **Critical Issues**: 2 disk health issues, 1 permission issue
- **Entities**: 1 Pod, 1 PVC, 1 PV, 1 Drive, 1 Node
- **Relationships**: Complete dependency chain mapped

## Generated Investigation Plan

```
Investigation Plan:
Target: Pod production/nginx-deployment-abc123, Volume Path: /var/www/html
Generated Steps: 8 main steps, 3 fallback steps

Step 1: Get all critical and high severity issues from Knowledge Graph | Tool: kg_get_all_issues(severity='critical') | Expected: List of critical issues that may be causing volume I/O errors

Step 2: Analyze issue patterns and relationships to identify root causes | Tool: kg_analyze_issues() | Expected: Root cause analysis with probability scores and relationship patterns

Step 3: Get high severity issues that may be related to the volume problem | Tool: kg_get_all_issues(severity='high') | Expected: High severity issues for comprehensive analysis

Step 4: Get detailed information about the problem pod and its current state | Tool: kg_get_entity_info(entity_type='Pod', entity_id='nginx-deployment-abc123') | Expected: Pod configuration, status, and any detected issues

Step 5: Find all entities related to the problem pod (PVC, PV, Node, etc.) | Tool: kg_get_related_entities(entity_type='Pod', entity_id='nginx-deployment-abc123', max_depth=2) | Expected: Complete dependency chain from Pod to underlying storage

Step 6: Get detailed Drive information including health status and metrics | Tool: kg_get_entity_info(entity_type='Drive', entity_id='drive-sda-worker-01') | Expected: Drive health status, SMART data, and any hardware issues

Step 7: Get Node information to check for node-level issues affecting storage | Tool: kg_get_entity_info(entity_type='Node', entity_id='worker-01') | Expected: Node health, resource usage, and any node-level storage issues

Step 8: Trace the complete path from Pod to Drive to understand dependencies | Tool: kg_find_path(source_entity_type='Pod', source_entity_id='nginx-deployment-abc123', target_entity_type='Drive', target_entity_id='drive-sda-worker-01') | Expected: Complete dependency chain with relationship details

Step 9: Get overall Knowledge Graph summary for system health context | Tool: kg_get_summary() | Expected: System overview with entity counts and issue statistics

Fallback Steps (if main steps fail):
Step F1: If specific entity lookup fails, get all medium severity issues | Tool: kg_get_all_issues(severity='medium') | Expected: Medium severity issues for broader analysis | Trigger: entity_not_found

Step F2: If no specific issues found, search for all Drive entities | Tool: kg_get_related_entities(entity_type='Drive', entity_id='any', max_depth=1) | Expected: List of all Drive entities for manual inspection | Trigger: no_issues_found

Step F3: If investigation data is incomplete, print full Knowledge Graph | Tool: kg_print_graph(include_details=True, include_issues=True) | Expected: Complete Knowledge Graph visualization for manual analysis | Trigger: insufficient_data
```

## Expected Execution Flow

### Phase 1 Execution
1. **Parse Plan**: Phase 1 will parse each step and extract tool names and arguments
2. **Sequential Execution**: Execute steps 1-9 in order, using specified Knowledge Graph tools
3. **Outcome Validation**: Compare actual results with expected outcomes for each step
4. **Fallback Handling**: If any step fails, execute appropriate fallback steps
5. **Evidence Aggregation**: Combine results from all steps for comprehensive analysis
6. **Root Cause Analysis**: Generate final diagnosis based on Investigation Plan results
7. **Fix Plan Generation**: Create actionable remediation steps

### Key Benefits
- **Structured Approach**: Systematic investigation following predetermined logic
- **Knowledge Graph Focus**: Leverages pre-collected data efficiently
- **Error Resilience**: Built-in fallback mechanisms for incomplete data
- **Traceability**: Clear audit trail of investigation steps
- **Deterministic Planning**: Consistent approach across different scenarios

## Integration with Existing Phases

### Workflow Enhancement
```
Phase 0: Information Collection
    ↓ (Knowledge Graph)
Plan Phase: Investigation Plan Generation  
    ↓ (Investigation Plan)
Phase 1: ReAct Investigation (Modified)
    ↓ (Root Cause + Fix Plan)
Phase 2: Remediation
```

### Modified Phase 1 Behavior
- **Input**: Investigation Plan + Knowledge Graph + collected_info
- **Process**: Execute Investigation Plan steps sequentially
- **Validation**: Compare expected vs actual outcomes
- **Enhancement**: Use additional ReAct tools when needed
- **Output**: Enhanced root cause analysis and fix plan

This demonstrates how the Plan Phase transforms the troubleshooting workflow from reactive investigation to planned, systematic diagnosis while maintaining the flexibility of the ReAct framework.
